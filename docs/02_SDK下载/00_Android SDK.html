    <!doctype html>
<!--[if lt IE 7]>
<html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>
<html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>
<html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <meta charset="utf-8"/>
    <title>文档中心</title>
    <meta name="keywords" content="documentation,dox"/>
    <meta name="description" content="项目开发相关文档"/>
    <link rel="stylesheet" type="text/css" href="../../templates/developer/assets/base.css"/>
    <link rel="stylesheet" type="text/css" href="../../static/themes/default/css/developer.css"/>
    <link rel="stylesheet" type="text/css" href="../../static/themes/default/css/typo.css"/>
    <script src="../../templates/default/assets/prettify.js"></script>
    <script src="../../templates/default/assets/jquery-1.8.2.min.js"></script>
</head>
<body>
<div class="outer-wrapper">
    <header class="top-bar top-bar-new">
        <div class="top-bar-wrapper">
            <div class="top-bar-left">
                <h1 class="logo"><a href="#">文档中心</a></h1>
            </div>
        </div>
    </header>
    <div class="sidebar">
        <div class="wrapper">
            <nav class="sidebar-nav">
                <div class="sidebar-content">
                    <ul>
                      <h1 class="nav-title">API文档</h1>

                <li >
                    <a href="../../docs/00_平台基本概述/00_平台概述.html">平台基本概述
                        <i class="disclosure"></i>
                    </a>
                    <ul>
                    
                            <li ><a  href="../../docs/00_平台基本概述/00_平台概述.html">平台概述</a></li>
                    
                            <li ><a  href="../../docs/00_平台基本概述/01_开发者协议.html">开发者协议</a></li>
                    
                            <li ><a  href="../../docs/00_平台基本概述/02_应用上线流程.html">应用上线流程</a></li>
                    
                            <li ><a  href="../../docs/00_平台基本概述/03_应用下线流程.html">应用下线流程</a></li>
                    
                    </ul>
                </li>

                <li >
                    <a href="../../docs/01_应用接入/01_接入流程.html">应用接入
                        <i class="disclosure"></i>
                    </a>
                    <ul>
                    
                            <li ><a  href="../../docs/01_应用接入/01_接入流程.html">接入流程</a></li>
                    
                            <li ><a  href="../../docs/01_应用接入/02_通用包审核标准.html">通用包审核标准</a></li>
                    
                            <li ><a  href="../../docs/01_应用接入/03_渠道包生成和分发.html">渠道包生成和分发</a></li>
                    
                    </ul>
                </li>

                <li class="active">
                    <a href="../../docs/02_SDK下载/00_Android SDK.html">SDK下载
                        <i class="disclosure"></i>
                    </a>
                    <ul>
                    
                            <li class="active"><a class="nav-title-active" href="../../docs/02_SDK下载/00_Android SDK.html">Android SDK</a></li>
                    
                            <li ><a  href="../../docs/02_SDK下载/01_iOS SDK.html">iOS SDK</a></li>
                    
                            <li ><a  href="../../docs/02_SDK下载/02_服务端接入.html">服务端接入</a></li>
                    
                    </ul>
                </li>

                    </ul>
                </div>
            </nav>
        </div>
    </div>
    <div class="main">
        <div class="wrapper">
            <section class="nav-page-content typo typo-selection" role="main">
                <h1 id="gameservice-sdk-_v1-0-0">GameService SDK 说明文档_V1.0.0</h1>
<p><a href="../../static/download/GameService 开发包 V1.0.0.zip" target="_blank" class="sdk-download">下载SDK</a></p>
<hr>
<h2 id="-sdk-">一、SDK包含内容</h2>
<ul>
<li><p>GameService SDK 说明文档_V1.0.0.pdf</p>
</li>
<li><p>依赖工程 library</p>
<ul>
<li>PushSDK_Release</li>
<li>alipay_lib</li>
</ul>
</li>
<li><p>示例程序工程 samples</p>
</li>
<li><p>示例程序安装包 SDKSample_V1.0.0.apk</p>
</li>
<li><p>密钥生成工具 openssl</p>
</li>
</ul>
<h2 id="-">二、项目配置</h2>
<p>2.1 增加工程依赖项目PushSDK_Release，alipay_lib；</p>
<p>2.2 拷贝 SDKSample libs 下的文件到主工程的libs下；</p>
<p>2.3 在PushSDK_Release的res/values/pushsdk_thirdparty_string.xml 中：</p>
<pre><code>    &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; standalone=&quot;no&quot;?&gt;
    &lt;resources&gt;
    &lt;string name=&quot;permission_service&quot;&gt;[your_prefix].android.permissions.SERVICE&lt;/string&gt;
    &lt;string name=&quot;permission_provider&quot;&gt;[your_prefix].android.permissions.PROVIDER&lt;/string&gt;
    &lt;string name=&quot;permission_vote&quot;&gt;[your_prefix].android.permissions.VOTE&lt;/string&gt;
    &lt;string name=&quot;permission_client&quot;&gt;[your_prefix].android.permissions.CLIENT&lt;/string&gt;
    &lt;string name=&quot;action_protect_service_start&quot;&gt;[your_prefix].intent.protect.service.action.START&lt;/string&gt;
    &lt;string name=&quot;action_protect_broadcast_service&quot;&gt;[your_prefix].intent.protect.service.action.BROADCAST&lt;/string&gt;
    &lt;string name=&quot;action_protect_broadcast_clinet&quot;&gt;[your_prefix].intent.protect.client.action.BROADCAST&lt;/string&gt;
    &lt;string name=&quot;action_opensdk_vote&quot;&gt;[your_prefix].intent.opensdk.action.VOTE&lt;/string&gt;
    &lt;string name=&quot;action_opensdk_consult&quot;&gt;[your_prefix].intent.opensdk.action.CONSULT&lt;/string&gt;
    &lt;string name=&quot;action_api_service_start&quot;&gt;[your_prefix].intent.api.service.action.START&lt;/string&gt;
    &lt;string name=&quot;sdk_appid&quot;&gt;8&lt;/string&gt;
    &lt;string name=&quot;sdk_appkey&quot;&gt;sVDIlIiDUm7tWPYWhi6kfNbrqui3ez44&lt;/string&gt;
    &lt;string name=&quot;sdk_domain&quot;&gt;TGXD_201405141634230591ktsNZU1FF&lt;/string&gt;
    &lt;string name=&quot;sdk_scheme&quot;&gt;[your_prefix]&lt;/string&gt;
    &lt;/resources&gt;
</code></pre><ul>
<li><p>将[your_prefix]修改成开发者需要指定的简称(一般以公司缩写为准)。如：ngds。</p>
</li>
<li><p>sdk_appid 的值为你在<a href="http://developers.gameservice.com/">GameService 开发网站</a>里真实分配到的appid,</p>
</li>
<li><p>sdk_appkey 的值为你在<a href="http://developers.gameservice.com/">GameService 开发网站</a>真实分配到的appkey。</p>
</li>
</ul>
<p>2.4 在主工程AndroidManifest中添加如下声明permission并做出相应替换：</p>
<pre><code>    &lt;uses-permission android:name=&quot;android.permission.BATTERY_STATS&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.ACCESS_WIFI_STATE&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.CHANGE_NETWORK_STATE&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.CHANGE_WIFI_STATE&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.VIBRATE&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.GET_PACKAGE_SIZE&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.BROADCAST_STICKY&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.READ_PHONE_STATE&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.SYSTEM_ALERT_WINDOW&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.READ_CALL_LOG&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.GET_TASKS&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.REORDER_TASKS&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.WAKE_LOCK&quot; /&gt;
    &lt;uses-permission android:name=&quot;android.permission.BLUETOOTH_ADMIN&quot;/&gt;
    &lt;uses-permission android:name=&quot;android.permission.BLUETOOTH&quot;/&gt;
    &lt;uses-permission android:name=&quot;com.android.launcher.permission.INSTALL_SHORTCUT&quot; /&gt;
    &lt;uses-permission android:name=&quot;com.android.launcher.permission.UNINSTALL_SHORTCUT&quot; /&gt;

    &lt;uses-permission android:name=&quot;[your_prefix].android.permissions.SERVICE&quot; /&gt;
    &lt;uses-permission android:name=&quot;[your_prefix].android.permissions.CLIENT&quot; /&gt;
    &lt;uses-permission android:name=&quot;[your_prefix].android.permissions.VOTE&quot; /&gt;
    &lt;permission android:name=&quot;[your_prefix].android.permissions.SERVICE&quot; android:protectionLevel=&quot;normal&quot; /&gt;
    &lt;permission android:name=&quot;[your_prefix].android.permissions.CLIENT&quot; android:protectionLevel=&quot;normal&quot; /&gt;
    &lt;permission android:name=&quot;[your_prefix].android.permissions.VOTE&quot; android:protectionLevel=&quot;normal&quot; /&gt;
</code></pre><ul>
<li>将[your_prefix]修改成开发者需要指定的简称(一般以公司缩写为准)，如：ngds，须和pushsdk_thirdparty_string.xml中的设置保持一致。</li>
</ul>
<p>2.5 在主工程AndroidManifest中增加如下activity, meta-data, service, receiver：</p>
<pre><code>    &lt;!-- 渠道号 --&gt;
    &lt;meta-data
        android:name=&quot;NGDS_CHANNEL&quot;
        android:value=&quot;14&quot; /&gt;

    &lt;!-- 登陆 --&gt;
    &lt;activity
        android:name=&quot;com.gameservice.sdk.activity.LoginSelectActivity&quot;
        android:configChanges=&quot;keyboardHidden|orientation&quot;
        android:theme=&quot;@android:style/Theme.Translucent.NoTitleBar.Fullscreen&quot; /&gt;
    &lt;activity
        android:name=&quot;com.gameservice.sdk.activity.LoginMobileActivity&quot;
        android:configChanges=&quot;keyboardHidden|orientation&quot;
        android:theme=&quot;@android:style/Theme.NoTitleBar&quot; /&gt;
    &lt;activity
        android:name=&quot;com.gameservice.sdk.activity.LoginVerifyCodeActivity&quot;
        android:configChanges=&quot;keyboardHidden|orientation&quot;
        android:theme=&quot;@android:style/Theme.NoTitleBar&quot; /&gt;

    &lt;!--支付--&gt;
    &lt;activity
        android:name=&quot;com.gameservice.sdk.activity.PayTypeSelectActivity&quot;
        android:configChanges=&quot;keyboardHidden|orientation&quot;
        android:theme=&quot;@android:style/Theme.NoTitleBar&quot; /&gt;
    &lt;activity
        android:name=&quot;com.gameservice.sdk.activity.BankCardActivity&quot;
        android:configChanges=&quot;keyboardHidden|orientation&quot;
        android:theme=&quot;@android:style/Theme.NoTitleBar&quot; /&gt;

    &lt;activity
        android:name=&quot;com.gameservice.sdk.activity.PayCodeActivity&quot;
        android:configChanges=&quot;keyboardHidden|orientation&quot;
        android:theme=&quot;@android:style/Theme.NoTitleBar&quot; /&gt;

    &lt;activity
        android:name=&quot;com.gameservice.sdk.activity.CoinActivity&quot;
        android:configChanges=&quot;keyboardHidden|orientation&quot;
        android:theme=&quot;@android:style/Theme.NoTitleBar&quot; /&gt;
    &lt;activity
        android:name=&quot;com.gameservice.sdk.activity.CoinRechargeActivity&quot;
        android:configChanges=&quot;keyboardHidden|orientation&quot;
        android:theme=&quot;@android:style/Theme.NoTitleBar&quot; /&gt;
    &lt;activity
        android:name=&quot;com.gameservice.sdk.activity.PhoneCardActivity&quot;
        android:configChanges=&quot;keyboardHidden|orientation&quot;
        android:theme=&quot;@android:style/Theme.NoTitleBar&quot; /&gt;
    &lt;activity
        android:name=&quot;com.gameservice.sdk.activity.PhoneCardLoginActivity&quot;
        android:configChanges=&quot;keyboardHidden|orientation&quot;
        android:theme=&quot;@android:style/Theme.NoTitleBar&quot; /&gt;
    &lt;activity
        android:name=&quot;com.gameservice.sdk.activity.PhoneCardResultActivity&quot;
        android:configChanges=&quot;keyboardHidden|orientation&quot;
        android:theme=&quot;@android:style/Theme.NoTitleBar&quot; /&gt;

    &lt;!--用户中心--&gt;
    &lt;activity
        android:name=&quot;com.gameservice.sdk.activity.UserCenterActivity&quot;
        android:configChanges=&quot;keyboardHidden|orientation&quot;
        android:theme=&quot;@android:style/Theme.NoTitleBar&quot; /&gt;
    &lt;activity
        android:name=&quot;com.gameservice.sdk.activity.UserBalanceActivity&quot;
        android:configChanges=&quot;keyboardHidden|orientation&quot;
        android:theme=&quot;@android:style/Theme.NoTitleBar&quot; /&gt;
    &lt;activity
        android:name=&quot;com.gameservice.sdk.activity.UserPwdActivity&quot;
        android:configChanges=&quot;keyboardHidden|orientation&quot;
        android:theme=&quot;@android:style/Theme.NoTitleBar&quot; /&gt;
    &lt;activity
        android:name=&quot;com.gameservice.sdk.activity.UserPwdForgetCodeActivity&quot;
        android:configChanges=&quot;keyboardHidden|orientation&quot;
        android:theme=&quot;@android:style/Theme.NoTitleBar&quot; /&gt;

    &lt;!--Web页面--&gt;
    &lt;activity
        android:name=&quot;com.gameservice.sdk.activity.WebActivity&quot;
        android:configChanges=&quot;keyboardHidden|orientation&quot;
        android:theme=&quot;@android:style/Theme.NoTitleBar&quot; /&gt;

    &lt;!--push--&gt;
    &lt;service
        android:name=&quot;com.tgx.push.sdk.MasterService&quot;
        android:permission=&quot;[your_prefix].android.permissions.SERVICE&quot;&gt;
          &lt;intent-filter&gt;
              &lt;action android:name=&quot;[your_prefix].intent.protect.service.action.START&quot; /&gt;
          &lt;/intent-filter&gt;
     &lt;/service&gt;
     &lt;service android:name=&quot;com.tgx.push.sdk.SdkService&quot; /&gt;
     &lt;receiver
        android:name=&quot;com.tgx.push.sdk.AutoConsultReceiver&quot;
        android:permission=&quot;[your_prefix].android.permissions.VOTE&quot;&gt;
          &lt;intent-filter android:priority=&quot;1&quot; &gt;
               &lt;action android:name=&quot;[your_prefix].intent.opensdk.action.VOTE&quot; /&gt;
               &lt;data android:host=&quot;[your_host]&quot; android:scheme=&quot;[your_prefix]&quot; /&gt;
          &lt;/intent-filter&gt;
     &lt;/receiver&gt;

     &lt;receiver android:name=&quot;com.gameservice.sdk.util.NgdsStaticReceiver&quot;&gt;
        &lt;intent-filter&gt;
            &lt;action android:name=&quot;android.intent.action.PACKAGE_ADDED&quot; /&gt;
            &lt;action android:name=&quot;android.intent.action.PACKAGE_CHANGED&quot; /&gt;
            &lt;action android:name=&quot;android.intent.action.PACKAGE_DATA_CLEARED&quot; /&gt;
            &lt;action android:name=&quot;android.intent.action.PACKAGE_INSTALL&quot; /&gt;
            &lt;action android:name=&quot;android.intent.action.PACKAGE_REMOVED&quot; /&gt;
            &lt;action android:name=&quot;android.intent.action.PACKAGE_REPLACED&quot; /&gt;
            &lt;action android:name=&quot;android.intent.action.PACKAGE_RESTARTED&quot; /&gt;
            &lt;action android:name=&quot;android.net.conn.CONNECTIVITY_CHANGE&quot; /&gt;
        &lt;/intent-filter&gt;
    &lt;/receiver&gt;
    &lt;service
        android:name=&quot;com.gameservice.sdk.collection.service.CollectService&quot;
        android:process=&quot;:remote&quot;&gt;
        &lt;intent-filter&gt;
            &lt;action android:name=&quot;com.gameservice.sdk.collection.service.ICollectService&quot; /&gt;
            &lt;action android:name=&quot;com.gameservice.sdk.collection.service.ISecondary&quot; /&gt;
            &lt;action android:name=&quot;com.gameservice.sdk.collection.service.REMOTE_SERVICE&quot; /&gt;
        &lt;/intent-filter&gt;
    &lt;/service&gt;

    &lt;receiver
        android:name=&quot;com.gameservice.sdk.collection.util.AlarmReceiver&quot;
        android:process=&quot;:remote&quot; /&gt;

    &lt;activity
    android:name=&quot;com.tgx.push.sdk.app.parser.view.PushSdkInfoActivity&quot;/&gt;
    &lt;activity
    android:name=&quot;com.tgx.push.sdk.app.parser.view.PushSdkDialogActivity&quot;/&gt;
</code></pre><ul>
<li><p>将[your_prefix]修改成开发者需要指定的简称(一般以公司缩写为准)，如：ngds，须和pushsdk_thirdparty_string.xml中的设置保持一致。</p>
</li>
<li><p>将[your_host]修改成pushsdk_thirdparty_string.xml的sdk_domain。</p>
</li>
<li><p>渠道号，默认配置成14，有发渠道包的请填具体的渠道号。</p>
</li>
</ul>
<h2 id="-api-">三、API使用说明</h2>
<h3 id="3-1-">3.1 设置屏幕方向</h3>
<pre><code>GameService.setScreenOrientation(int orientation)
</code></pre><p>使用SDK业务接口前调用该函数。参数orientation取值如下：</p>
<pre><code>GameService.SCREEN_ORIENTATION_LANDSCAPE             // 横屏
GameService.SCREEN_ORIENTATION_PORTRAIT              // 竖屏
</code></pre><h3 id="3-2-">3.2 登陆</h3>
<pre><code>GameService.login(Context context, OnLoginListener listener)
</code></pre><p>调用示例:</p>
<pre><code>GameService.login(MainActivity.this, new OnLoginListener() {
    @Override
    public void finish(int code, OAuthInfo oAuthInfo) {
        String msg = &quot;&quot;;
        switch (code) {
            case StatusCode.FINISH:
                msg = &quot;token: &quot; + oAuthInfo.getAccessToken();
                break;
            case StatusCode.CANCEL:
                msg = &quot;取消登陆&quot;;
                break;
            default:
                break;
        }
        Toast.makeText(MainActivity.this, msg, Toast.LENGTH_LONG).show();
        Log.d(&quot;OAuth: &quot;, +code + &quot;: &quot; + msg);
    }
});
</code></pre><h3 id="3-3-">3.3 支付</h3>
<pre><code>GameService.pay(Context context, Order order, OnPayListener listener)
</code></pre><p>调用示例：</p>
<pre><code>Order order = testOrder();
String orderStr = getOrderString(order);
Log.d(&quot;orderStr:&quot;, orderStr);
order.setSign(com.gameservice.sdk.sample.view.main.Rsa
    .sign(orderStr, com.gameservice.sdk.sample.view.main.Keys.PRIVATE));
Log.d(&quot;signStr: &quot;, order.getSign());
GameService.pay(this, order, new OnPayListener() {
    @Override public void finish(int code, String msg) {
        switch (code) {
            case StatusCode.FINISH:
                msg = &quot;支付完成&quot;;
                break;
            case StatusCode.CANCEL:
                msg = &quot;取消支付&quot;;
                break;
            default:
                break;
        }
        Toast.makeText(TestPayActivity.this, msg, Toast.LENGTH_LONG).show();
        Log.d(&quot;onPay&quot;, code + &quot;: &quot; + msg);
    }
});
</code></pre><h5 id="-">支付回调:</h5>
<p>请求地址：POST {{生成订单传的notify_url}}</p>
<p>请求内容：</p>
<pre><code>amount=1&amp;app_id=1&amp;app_order_id=123467983411&amp;app_user_id=123&amp;app_user_name=角色名&amp;body=充值卡测试1&amp;create_time=1403896654&amp;notify_time=1403897051&amp;order_id=20140627162026744468&amp;payment_time=1403897051&amp;status=STATUS_SUCCESS&amp;subject=充值卡测试1
</code></pre><ul>
<li><p>成功响应： 根据status判断是否STATUS_SUCCESS</p>
</li>
<li><p>失败响应： 除了status为STATUS_SUCCESS以外，都认为是失败</p>
</li>
</ul>
<h3 id="3-4-">3.4 统计采集</h3>
<p> 正确集成如下代码，才能够保证获取正确的用户使用基本数据。</p>
<ul>
<li><p>在每个Activity的onResume方法中调用 GameService.onResume(this) ,onPause方法中调用  GameService.onPause(this)</p>
<pre><code>  @Override
  protected void onPause() {
      GameService.onPause(this);
      super.onPause();
  }

  @Override
  protected void onResume() {
      GameService.onResume(this);
      super.onResume();
  } 
</code></pre></li>
<li><p>确保在所有的Activity中都调用 MobclickAgent.onResume() 和MobclickAgent.onPause()方法，这两个调用将不会阻塞应用程序的主线程，也不会影响应用程序的性能。</p>
</li>
<li><p>玩家用户登录行为记录（用于玩家行为统计以及进行玩家间p2p推送）：    </p>
<pre><code>  GameService.onPlayerLogin(context, PLAYER_ID); 
</code></pre><p>其中PLAYER_ID为玩家id。</p>
</li>
<li><p>玩家用户登出记录（用于玩家行为统计以及不再接收玩家间p2p推送）：</p>
<pre><code>  GameService.onPlayerLogout(Context context); 
</code></pre></li>
<li><p>玩家用户付款行为统计：</p>
<pre><code>  GameService.onPay(Context context, String playerId, String payAmount)
</code></pre></li>
</ul>
<h3 id="3-5-">3.5 推送服务</h3>
<ul>
<li><p>push服务初始化及绑定</p>
<ul>
<li>方法： GameService.<strong>startPushService</strong> (Context ctx) </li>
<li>功能： 完成push服务的初始化工作，以及与MasterService的自动绑定工作。当masterService第一次启动完成登录操作。</li>
<li>参数： ctx 当前执行的上下文。</li>
</ul>
</li>
<li><p>push 服务的停止</p>
<ul>
<li>方法： GameService.<strong>stopPushService</strong>(Context ctx)    + 功能： 停止当前应用的push服务，以及与MasterService 的解绑操作。</li>
<li>参数： ctx 当前上下文</li>
</ul>
</li>
<li><p>设置Tags</p>
<ul>
<li>方法： GameService.<strong>setPushTags</strong> (Context context,String[] tags,String charset)</li>
<li>功能： 为App进行属性标注，最大标签数100，使用时必须使用一致的charset，cid不能作为tag使用</li>
<li>参数 <ul>
<li>tags 你当前需要的标签集合</li>
<li>charset 当前tags 的编码格式，不设置默认为‘UTF-8‘</li>
</ul>
</li>
</ul>
</li>
<li>p2p消息发送（用于游戏内一个玩家给另外一个玩家发送消息）<ul>
<li>方法： GameService.<strong>sendMsg</strong> (Context context, String fromPlayerId, String toPlayerId, String msg)</li>
<li>功能： 用于游戏内一个玩家给另外一个玩家发送消息</li>
<li>参数 <ul>
<li>context 内容上下文</li>
<li>fromPlayerId 发送者的id（注：此id必须之前调用过GameService.onPlayerLogin(context, PLAYER_ID)保证在服务端已成功注册）</li>
<li>toPlayerId 信息接收用户id（注：此id必须之前调用过GameService.onPlayerLogin(context, PLAYER_ID)保证在服务端已成功注册）         </li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="abstractmsgreceiver-">AbstractMsgReceiver（消息接收父类）</h5>
<table>
<thead>
<tr>
<th>分类</th>
<th>功能</th>
<th>方法</th>
</tr>
</thead>
<tbody>
<tr>
<td>push消息接口</td>
<td>回调 push 消息</td>
<td>onMessage</td>
</tr>
<tr>
<td>调试消息接口</td>
<td>回调 debug 消息</td>
<td>onDebug</td>
</tr>
<tr>
<td>p2p消息接口</td>
<td>回调 p2p 消息</td>
<td>onImReceive</td>
</tr>
</tbody>
</table>
<ul>
<li><p>接收到的push消息</p>
<ul>
<li>方法： public abstract void <strong>onMessage</strong>(String message)</li>
<li>功能： 接收到的push消息回调</li>
<li>参数： push 内容</li>
</ul>
</li>
<li><p>接收到的debug消息</p>
<ul>
<li>方法： public void <strong>onDebug</strong>(String message)</li>
<li>功能： 获取设备ID</li>
<li>参数： debug 内容</li>
</ul>
</li>
<li><p>接收到的p2p消息</p>
<ul>
<li>方法： public void <strong>onImReceive</strong>(String fromTuid,String toTuid,String message)</li>
<li>功能： 获取设备ID</li>
<li>参数<ul>
<li>fromTuid 发送消息的来源 Tuid</li>
<li>toTuid   消息的目标     Tuid</li>
<li>message  p2p 消息内容</li>
</ul>
</li>
</ul>
</li>
<li><p>注册消息接收者</p>
<ul>
<li>方法： GameService.<strong>registerReceiver</strong>(Class&lt;? extends AbstractMsgReceiver&gt; clzz)</li>
<li>功能： 为App注册消息接收接口。</li>
<li>参数： 消息处理类</li>
</ul>
</li>
<li><p>反注册消息接收者</p>
<ul>
<li>方法： GameService.<strong>unRegisterReceiver</strong>()</li>
<li>功能： 为App反注册消息接收者。</li>
</ul>
</li>
</ul>
<p><strong>如果要保证能正常接收消息一定要在代码中实现继承AbstractMsgReceiver并做以下调用正常开启推送服务，内容在PushServiceActivity中：</strong></p>
<pre><code>GameService.registerMsgReceiver(PushMessageReceiver.class);
        GameService.setPushTags(getApplicationContext(), new String[]{&quot;your tag&quot;}, null);//设置标签为可选项
        GameService.startPushService(this);
</code></pre><h2 id="-">四、相关类介绍</h2>
<h3 id="4-1-">4.1 回调函数类</h3>
<pre><code>    // 支付回调
    public static interface OnPayListener {
        void finish(int code, String msg);
    }

    // 登陆回调
    public static interface OnLoginListener {
        void finish(int code, OAuthInfo authInfo);
    }
</code></pre><h3 id="4-2-">4.2 状态码类</h3>
<pre><code>public class StatusCode {

    // 处理中
    public static final int PROCESS = 1000;
    // 完成
    public static final int FINISH = 2000;
    // 取消
    public static final int CANCEL = 3000;
    // 失败
    public static final int ERROR = 5000;
    // 未知错误
    public static final int ERROR_UNKNOW = 5001;
    // 网络错误
    public static final int ERROR_NETWORK_FAIL = 5002;
    // 参数错误
    public static final int ERROR_PARAM = 5003;
    // 请求超时
    public static final int ERROR_TIME_OUT = 5004;
}
</code></pre><h3 id="4-3-">4.3 认证信息类</h3>
<pre><code>public class OAuthInfo implements BaseType {

    public static final String GRANT_TYPE_MOBILE = &quot;sms_code&quot;;

    public static final String GRANT_TYPE_CLIENT_CREDENTIALS = &quot;client_credentials&quot;;

    public static final String GRANT_TYPE_SNS_TOKEN = &quot;sns_token&quot;;

    // 认证类型
    public String getGrantType() 

    // 认证Token
    public String getAccessToken() 

    // 用户ID
    public String getUserId() 

    // 用户名称
    public String getUserName() 

    // 用户昵称
    public String getNickName() 

    // 用户头像url
    public String getAvatarUrl() 

}
</code></pre><h3 id="4-4-">4.4 订单类</h3>
<pre><code>public class Order implements BaseType {
    // 商品名
    public String getSubject() 
    public void setSubject(String subject)

    // 商品描述
    public String getBody() 
    public void setBody(String body) 

    // 价格 单位分
    public int getMoney() 
    public void setMoney(int money) 

    // 回调地址
    public String getNotifyUrl() 
    public void setNotifyUrl(String notifyUrl) 

    // 用户名称
    public String getUserName() 
    public void setUserName(String userName) 

    // 用户ID
    public String getUserId() 
    public void setUserId(String userId) 

    // 订单号
    public String getOrderId() 
    public void setOrderId(String orderId) 

    // 应用ID
    public String getAppId() 
    public void setAppId(String appId) 

    // 渠道ID
    public int getChannelId() 
    public void setChannelId(int channelId) 

    // IMEI
    public String getImei() 
    public void setImei(String imei)

    // MAC地址 
    public String getMacAddress() 
    public void setMacAddress(String macAddress) 

    // 扩展信息，开发者选填，回调开发者服务器使用
    public String getExtInfo() 
    public void setExtInfo(String extInfo) 

    // 签名信息
    public String getSign() 
    public void setSign(String sign) 
}
</code></pre><h2 id="-">五、交易签名</h2>
<h3 id="-">密钥生成命令</h3>
<pre><code>// 生成RSA私钥
openssl&gt;genrsa -out rsa_private_key.pem 1024

// 生成RSA公钥
openssl&gt;rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem

// 将RSA私钥转换成PKCS8格式
openssl&gt;pkcs8 -topk8 -inform PEM -in rsa_private_key.pem -outform PEM -nocrypt
</code></pre><ul>
<li>注意：“&gt;”符号后面的才是需要输入的命令。</li>
</ul>
<h3 id="-">需要参与签名的参数</h3>
<ul>
<li>在请求参数列表中，除去sign、payment参数外，其他需要使用到的参数皆是要签名的参数。</li>
<li>在服务器异步通知参数列表中，除去sign参数外，凡是通知返回回来的参数皆是要验签的参数。</li>
</ul>
<h3 id="-">生成待签名字符串</h3>
<p>对于如下的参数：</p>
<pre><code>{
    &quot;body&quot;: &quot;【2元包邮】韩版 韩国 流行饰品太阳花小巧雏菊 珍珠项链2M15&quot;,
    &quot;subject&quot;: &quot;珍珠项链 【2元包邮】韩版 韩国 流行饰品太阳花小巧雏菊 珍珠项链2M15&quot;,
    &quot;amount&quot;: 2,
    &quot;app_user_name&quot;: &quot;角色名&quot;,
    &quot;app_id&quot;: &quot;1&quot;,
    &quot;app_order_id&quot;: &quot;201404250461774836&quot;,
    &quot;imei&quot;: &quot;447769804451095&quot;,
    &quot;ext&quot;: &quot;&quot;,
    &quot;notify_url&quot;: &quot;http://127.0.0.1/pay/test&quot;,
    &quot;app_user_id&quot;: &quot;123&quot;,
    &quot;mac_address&quot;: &quot;05-16-DC-59-C2-34&quot;,
    &quot;bind_id&quot;: &quot;6306&quot;,
    &quot;channel_id&quot;: &quot;test&quot;,
    &quot;sign&quot;: &quot;&quot;
}
</code></pre><p>去掉sign参数，将其他参数按照字母顺序升序排列，再把所有数组值以“&amp;”字符连接起来：</p>
<p>amount=2&amp;app_id=1&amp;app_order_id=201404250461774836&amp;app_user_id=123&amp;app_user_name=角色名&amp;bind_id=6306&amp;body=【2元包邮】韩版 韩国 流行饰品太阳花小巧雏菊 珍珠项链2M15&amp;channel_id=test&amp;imei=447769804451095&amp;mac_address=05-16-DC-59-C2-34&amp;notify_url=<a href="http://127.0.0.1/pay/test&amp;subject=珍珠项链">http://127.0.0.1/pay/test&amp;subject=珍珠项链</a> 【2元包邮】韩版 韩国 流行饰品太阳花小巧雏菊 珍珠项链2M15
即为待签名字符串。 </p>
<p>注意：没有值的参数无需传递，也无需包含到待签名数据中；</p>
<h3 id="rsa-">RSA签名</h3>
<p>在RSA的签名时，需要私钥和公钥一起参与签名。私钥与公钥皆是客户通过OPENSSL来生成得出的。客户把生成出的公钥与新游平台技术人员配置好的新游公钥做交换。因此，在签名时，客户要用到的是客户的私钥及新游的公钥。 </p>
<ul>
<li><p>请求时签名 当拿到请求时的待签名字符串后，把待签名字符串与客户的私钥一同放入RSA的签名函数中进行签名运算，从而得到签名结果字符串。</p>
</li>
<li><p>通知返回时验证签名 当获得到通知返回时的待签名字符串后，把待签名字符串、新游提供的公钥、新游通知返回参数中的参数sign的值三者一同放入RSA的签名函数中进行非对称的签名运算，来判断签名是否验证通过。</p>
</li>
<li><p>签名函数 RSA sign + base64 encode</p>
</li>
</ul>
<h2 id="-">六、代码混淆</h2>
<p>GameService的SDK 包是以 jar 包及资源文件提供给用户的,您在混淆自己 APK 包的时候请不要将 GameService 的 jar 包一起混淆, 若被混淆后会因为无法找到相关类而抛异常。
您可以在用 ant 构建混淆包的 build.xml 里面对应位置或者在工程的混淆配置文件里加入:</p>
<p>-libraryjars libs/*.jar<br>-keep class com.gameservice.sdk.**<br>-keep class com.tgx.push.**<br>-keep class com.alipay.**</p>
<p>以避免GameService的相关的 jar 包被混淆。</p>

            </section>
        </div>
    </div>
</div>
<a href="#" class="btn-top" id="btn_top"><span class="vertical">回顶部</span></a>
<script>
    $(function () {
        $('pre').addClass('prettyprint');
        $('td pre').removeClass('prettyprint');
        prettyPrint();
        $('.response-btn').on('click', function (e) {
            var sectionNode = $(this).closest('.api-section');
            sectionNode.find('.api-response').slideToggle();
        });
        var navHtml = '';
        var text = $('.nav-title-active').text();
        if (text.indexOf('Android SDK') != -1 || text.indexOf('iOS SDK') != -1 || text.indexOf('服务端接入') != -1) {
//            console.log(text);
            //抽取标题索引
            $('h1,h2,h3,h4,h5,h6').each(function (i) {
                $(this).attr('id', 'anchor-' + i);
            })
        } else {
            navHtml += '<header><h1>' + text + '</h1></header>';
        }
        if ($('.api-section').length > 0) {
            navHtml += '<div class="index-nav index-endpoints">';
            navHtml += '    <ul>';
            $('.api-section').each(function (item) {
                var id = $(this).attr('id');
                var method = $(this).find('.api-method').eq(0).text().toUpperCase();
                var api = $(this).find('.api-rule').eq(0)[0].innerHTML;
                var desc = $(this).find('.api-description').eq(0).find('p').eq(0).text();
                navHtml += '        <li>';
                navHtml += '            <a href="#' + id + '">';
                navHtml += '                <span class="type">' + method + '</span>';
                navHtml += '                <b>' + api + '</b>';
                navHtml += '                <span class="description">' + desc + '</span>';
                navHtml += '                <i></i>';
                navHtml += '            </a>';
                navHtml += '        </li>';
            });
            navHtml += '    </ul>';
            navHtml += '</div>';
        }
        $('.nav-page-content').prepend(navHtml);
        var sidebar = $('.sidebar');
        $(window).on('scroll', function () {
            scrollTop = $(this).scrollTop();

            if (scrollTop > 62) {
                sidebar.css({'position': 'fixed', 'top': '0'});
            } else {
                console.log(scrollTop);
                sidebar.css({'position': 'absolute','top':62});
            }
            if (scrollTop > $(this).height()) {
                $('#btn_top').show();
            } else {
                $('#btn_top').hide();
            }
        })
    });
</script>
</body>
</html>
