<!doctype html>
<!--[if lt IE 7]>
<html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>
<html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>
<html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <meta charset="utf-8"/>
    <title>文档中心</title>
    <meta name="keywords" content="documentation,dox"/>
    <meta name="description" content="项目开发相关文档"/>
    <link rel="stylesheet" type="text/css" href="http://docs.gameservice.com/templates/developer/assets/base.css"/>
    <link rel="stylesheet" type="text/css" href="http://docs.gameservice.com/static/themes/default/css/developer.css"/>
    <link rel="stylesheet" type="text/css" href="http://docs.gameservice.com/static/themes/default/css/typo.css"/>
    <script src="http://docs.gameservice.com/templates/default/assets/prettify.js"></script>
    <script src="http://docs.gameservice.com/templates/default/assets/jquery-1.8.2.min.js"></script>
</head>
<body>
<div class="header">
    <div class="inner-wrapper">
        <!--<div class="opt rt">-->
            <!--<a href="http://developers.gameservice.com/register">注册</a>-->
        <!--</div>-->
        <div class="logo"><a href="http://www.gameservice.com/">NGDS</a></div>
        <!--<div class="nav">-->
            <!--<ul>-->
                <!--<li class="item"><a class="link" href="http://developers.gameservice.com/push">智能推送</a></li>-->
                <!--<li class="item"><a class="link" href="http://developers.gameservice.com/data">数据分析</a></li>-->
                <!--<li class="item"><a class="link" href="http://docs.gameservice.com/docs/sdk/Android-SDK.html" target="_blank">SDK下载</a></li>-->
                <!--<li class="item"><a class="link" target="_blank" href="http://docs.gameservice.com/">帮助文档</a>-->
                <!--</li>-->
            <!--</ul>-->
        <!--</div>-->
    </div>
</div>
<div class="outer-wrapper">

<div class="sidebar">
    <div class="wrapper">
        <nav class="sidebar-nav">
            <div class="sidebar-content">
                <h1 class="nav-title">推送文档</h1>
                <ul>

            <li  ><a href="http://docs.gameservice.com/push/push_flow.html">推送接入流程</a><i class="disclosure"></i></li>

            <li  ><a href="http://docs.gameservice.com/push/server_push_api.html">服务端推送接口</a><i class="disclosure"></i></li>

            <li  ><a href="http://docs.gameservice.com/push/Android-SDK.html">Android SDK接入指南</a><i class="disclosure"></i></li>

                <li class="factive">

                    <a href="http://docs.gameservice.com/push/iOS/iOS-SDK.html">iOS SDK接入
                        <i class="disclosure"></i>
                    </a>
                    <ul>
                    
                            <li class="active"><a class="nav-title-active" href="http://docs.gameservice.com/push/iOS/iOS-SDK.html">iOS SDK接入指南</a></li>
                    
                            <li ><a  href="http://docs.gameservice.com/push/iOS/Create_APNG_Certificate.html">APNS证书创建流程</a></li>
                    
                    </ul>
                </li>

</ul>

            </div>
        </nav>
    </div>
</div>
<div class="main">
    <div class="wrapper">
        <div class="nav-page-content typo typo-selection" role="main">
            <h1 id="ngpushservice-ios-sdk-v1-0-0">NGPushService iOS SDK 说明文档 V1.0.0</h1>
<p><a href="../../static/download/NGPushService_iOS_SDK V1.0.0.zip" target="_blank" class="sdk-download">下载iOS SDK</a></p>
<h2 id="-">更新履历</h2>
<table>
<thead>
<tr>
<th>版本号</th>
<th>时间</th>
<th>更新内容</th>
</tr>
</thead>
<tbody>
<tr>
<td>v1.0.0</td>
<td>2014.09.19</td>
<td>SDK正式版发布</td>
</tr>
</tbody>
</table>
<h2 id="1-sdk-">1、SDK构成</h2>
<ol>
<li>静态库 libNGPushServiceSDK.a, libNGPushServiceSDK-arm64.a</li>
<li>头文件: NGPushService.h, NGPushServiceDefines.h</li>
<li>Demo工程</li>
</ol>
<p>NGPushService SDK支持armv7、armv7s和arm64架构的iOS设备，iOS要求5.0以上，Xcode要求4.2以上，操作系统要求Mac OS X 10.7以上。</p>
<ul>
<li>如果需要支持arm64，请使用静态库libNGPushServiceSDK-arm64.a</li>
</ul>
<h2 id="2-">2、项目配置</h2>
<h3 id="2-1-">2.1 添加链接参数</h3>
<p>在工程target的&quot;Build Settings&quot;中，找到&quot;Linking&quot;的&quot;Other Linker Flags&quot;，添加参数<code>-ObjC</code>。
<img src="./sdk-files/linker.png" alt=""></p>
<h3 id="2-2-framework">2.2 添加Framework</h3>
<p>在工程target中添加以下的framework:</p>
<pre><code>SystemConfiguration.framework
CoreTelephony.framework
UIKit.framework
</code></pre><p><img src="./sdk-files/add_frameworks.png" alt="image"></p>
<h3 id="2-3-ngpushservice">2.3 添加NGPushService</h3>
<ol>
<li><p>将NGPushServiceSDK文件夹拖入Xcode工程.</p>
</li>
<li><p>在项目target的&quot;build settings&quot;中，找到&quot;Search Paths&quot;的&quot;Library Search Paths&quot;, 如果NGPushServiceSDK的路径是绝对路径的，请改为相对路径。
 <img src="./sdk-files/library_path.png" alt="image"></p>
</li>
</ol>
<h2 id="3-sdk-">3、推送SDK使用</h2>
<h3 id="3-1-p12-">3.1 配置推送证书(已经有p12证书的可以跳过这一步)</h3>
<p>详见<a href="http://docs.gameservice.com/push/iOS/Create_APNG_Certificate.html">APNS证书创建流程</a>。</p>
<h3 id="3-2-gameservice">3.2 上传推送证书到GameService</h3>
<ul>
<li>登录GameService开发者后台；</li>
<li>在<strong>游戏管理</strong>页面，在对应游戏的那一行上点击<strong>编辑</strong>按钮进入编辑界面；</li>
<li>点击<strong>开发环境APNS证书</strong>打开文件选择框，选择p12证书并上传；</li>
</ul>
<h3 id="3-3-sdk">3.3 初始化SDK</h3>
<p>AppID和AppKey请到<a href="http://developers.gameservice.com/">GameService 开发网站</a>后台查看获取，需要先创建App。</p>
<p>初始化需要设置AppID和AppKey：</p>
<pre><code>[NGPushService setAppID:@&quot;10057&quot; AppSecret:@&quot;n6tE8Nr0TRrxkxovOd4btirTyR8J3Ku6&quot;];
</code></pre><h3 id="3-4-device-token">3.4 获取并上传device token</h3>
<p>请求device token:</p>
<pre><code>[[UIApplication sharedApplication] registerForRemoteNotificationTypes:UIRemoteNotificationTypeBadge | UIRemoteNotificationTypeAlert | UIRemoteNotificationTypeSound];
</code></pre><p>在UIApplicationDelegate中获取device token，上传到GameService：</p>
<pre><code>- (void)application:(UIApplication *)application didRegisterForRemoteNotificationsWithDeviceToken:(NSData *)deviceToken {
    [NGPushService setPushToken:deviceToken]; //上传device token
}
</code></pre><p>如果无法获取到到device token，请在<code>application:didFailToRegisterForRemoteNotificationsWithError:</code>中查看错误原因：</p>
<pre><code>- (void)application:(UIApplication *)application didFailToRegisterForRemoteNotificationsWithError:(NSError *)error {
    NSLog(@&quot;%@&quot;, error);
}
</code></pre><h2 id="4-sdk-">4、统计SDK使用</h2>
<h3 id="4-1-id-pushtoken-id-0-">4.1 设置登录玩家ID，在pushToken设置之后，玩家登录完成时调用此接口。如果开发的游戏不存在玩家ID，则设置为&quot;0&quot;</h3>
<pre><code>[NGPushService setLoginPlayerID:@&quot;123&quot;];
</code></pre><ul>
<li>注意，未正确设置pushToken则<code>setLoginPlayerID:</code>不可用。</li>
</ul>
<h3 id="4-2-id-">4.2 设置渠道ID (可选)</h3>
<pre><code>[NGPushService setChannelID:@&quot;91_store&quot; channelName:@&quot;91手机助手&quot;];
</code></pre><ul>
<li>渠道ID命名可采用英文字母、数字和下划线的组合，例如&quot;360&quot;, &quot;91_store&quot;, &quot;AppStore&quot;等,在GameService网站中可以给渠道ID添加别名以方便查看</li>
</ul>
<h3 id="4-3-">4.3 统计支付</h3>
<pre><code>NGPaymentRecord *paymentRecord = [[NGPaymentRecord alloc] init];
paymentRecord.player_id = @&quot;123&quot;;
paymentRecord.channel_id = @&quot;91_store&quot;;            //渠道ID
paymentRecord.channel_name = @&quot;91手机助手&quot;;          //渠道名
paymentRecord.amount = 100;                           //充值金额，浮点型，精确到小数点后两位
paymentRecord.payment_channel = @&quot;alipay&quot;;       //支付渠道，自定义字符串
paymentRecord.currency = @&quot;人民币&quot;;               //金额币种，自定义字符串
paymentRecord.coin_amount = 1000;                //充值的游戏币
paymentRecord.order_id = @&quot;201409190001&quot;;        //订单号，字符串，由游戏客户端定义。
paymentRecord.level = 50;                          //玩家等级
paymentRecord.server_id = @&quot;AppStore_1&quot;;         //服务器ID
paymentRecord.server_name = @&quot;AppStore服务器1&quot;;   //服务器名
[NGPushService pay:paymentRecord];
[NGPushService pay:paymentRecord];
</code></pre><ul>
<li>玩家等级为0-100的数字。</li>
<li>服务器ID命令采用英文字母、数字和下划线的组合，例如可以用&quot;91Store_1&quot;表示&quot;91助手1号联运服务器&quot;&quot;，&quot;AppStore100&quot;表示AppStore的100号服务器，服务器ID在GameService网站中可以添加别名，方便项目人员查看。</li>
</ul>
<h3 id="4-4-uiapplicationdidbecomeactivenotification-">4.4 统计玩家进入某个等级，在玩家升级之后或者登录游戏(在<code>UIApplicationDidBecomeActiveNotification</code>消息处理函数中判断玩家是否登录，登录则调用)之后调用</h3>
<pre><code>NGLevelRecord *levelRecord = [NGLevelRecord new];
levelRecord.player_id = @&quot;123&quot;;
levelRecord.channel_id = @&quot;91_store&quot;;            //渠道ID
levelRecord.channel_name = @&quot;91手机助手&quot;;         //渠道名
levelRecord.server_id = @&quot;AppStore_1&quot;;           //服务器ID
levelRecord.server_name = @&quot;AppStore服务器1&quot;;     //服务器名
levelRecord.player_level = 50;                   //玩家等级，0-100的数字
[NGPushService reachLevel:levelRecord];
</code></pre><h3 id="4-5-uiapplicationwillresignactivenotification-">4.5 统计玩家离开某个等级，在玩家升级之前和退出游戏之前调用(在<code>UIApplicationWillResignActiveNotification</code>消息处理函数中判断玩家是否有等级，有等级则调用)</h3>
<pre><code>NGLevelRecord *levelRecord = [NGLevelRecord new];
levelRecord.player_id = @&quot;123&quot;;
levelRecord.channel_id = @&quot;91_store&quot;;               //渠道ID
levelRecord.channel_name = @&quot;91手机助手&quot;;            //渠道名
levelRecord.server_id = @&quot;AppStore_1&quot;;
levelRecord.server_name = @&quot;AppStore服务器1&quot;;        //服务器名
levelRecord.player_level = 50;
[NGPushService leaveLevel:levelRecord];
</code></pre><ul>
<li>reachLevel:和leaveLevel:配合使用，统计玩家在某个等级的在线时间。</li>
</ul>
<h3 id="4-6-">4.6 统计玩家进入关卡</h3>
<pre><code>NGMissionRecord *missionRecord = [NGMissionRecord new];
missionRecord.player_id = @&quot;123&quot;;
missionRecord.channel_id = @&quot;91_store&quot;;             //渠道ID
missionRecord.channel_name = @&quot;91手机助手&quot;;          //渠道名
missionRecord.server_id = @&quot;AppStore_1&quot;;
missionRecord.server_name = @&quot;AppStore服务器1&quot;;      //服务器名
missionRecord.mission_id = @&quot;100001&quot;;               //关卡id
missionRecord.mission_name = @&quot;第一关：新手村&quot;;        //关卡名
[NGPushService enterMission:missionRecord];
</code></pre><ul>
<li>关卡ID用&quot;100001&quot;到&quot;199999&quot;之间的字符串表示，&quot;100001&quot;表示第1关，依次增加。在GameService网站中可以给关卡添加别名，比如&quot;100001&quot;别名为&quot;第一关&quot;，&quot;100001&quot;别名为“第二关”。</li>
</ul>
<h3 id="4-7-">4.7 统计玩家离开关卡，在玩家离开关卡或者退出游戏时调用</h3>
<pre><code>NGMissionRecord *missionRecord = [NGMissionRecord new];
missionRecord.player_id = @&quot;123&quot;;
missionRecord.channel_id = @&quot;91_store&quot;;             //渠道ID
missionRecord.channel_name = @&quot;91手机助手&quot;;          //渠道名
missionRecord.server_id = @&quot;AppStore_1&quot;;
missionRecord.server_name = @&quot;AppStore服务器1&quot;;      //服务器名
missionRecord.mission_id = @&quot;100001&quot;;
missionRecord.mission_name = @&quot;第一关：新手村&quot;;        //关卡名
[NGPushService leaveMission:missionRecord];
</code></pre><h3 id="4-8-">4.8 统计玩家消费行为</h3>
<pre><code>NGConsumptionRecord *consumptionRecord = [NGConsumptionRecord new];
consumptionRecord.player_id = @&quot;123&quot;;
consumptionRecord.channel_id = @&quot;91_store&quot;;             //渠道ID
consumptionRecord.channel_name = @&quot;91手机助手&quot;;          //渠道名
consumptionRecord.server_id = @&quot;AppStore_1&quot;;
consumptionRecord.server_name = @&quot;AppStore服务器1&quot;;      //服务器名
consumptionRecord.item_id = @&quot;11&quot;;                      //消费的商品ID
consumptionRecord.item_name = @&quot;钻石60个&quot;;               //消费的商品名称
consumptionRecord.item_amount = 1;                      //消费商品数量
consumptionRecord.coin_amount = 100;                    //话费虚拟币
[NGPushService consumption:consumptionRecord];
</code></pre><h3 id="4-9-">4.9 统计玩家剩余虚拟币</h3>
<pre><code>NGCoinRecord *coinRecord = [NGCoinRecord new];
coinRecord.player_id = @&quot;123&quot;;
coinRecord.channel_id = @&quot;91_store&quot;;                    //渠道ID
coinRecord.channel_name = @&quot;91手机助手&quot;;                 //渠道名
coinRecord.server_id = @&quot;AppStore_1&quot;;
coinRecord.server_name = @&quot;AppStore服务器1&quot;;             //服务器名
coinRecord.coin_amount = 90000;                         //剩余虚拟币
[NGPushService coin:coinRecord];
</code></pre>
        </div>
    </div>
</div>
</div>
<a href="#" class="btn-top" id="btn_top"><span class="vertical">回顶部</span></a>
<script>
    $(function () {
        $('pre').addClass('prettyprint');
        $('td pre').removeClass('prettyprint');
        prettyPrint();
        $('.response-btn').on('click', function (e) {
            var sectionNode = $(this).closest('.api-section');
            sectionNode.find('.api-response').slideToggle();
        });
        var navHtml = '';
        var text = $('.nav-title-active').text();
        if (text.indexOf('Android SDK') != -1 || text.indexOf('iOS SDK') != -1 || text.indexOf('服务端接入') != -1 || text.indexOf('服务端推送接口') != -1) {
//            console.log(text);
            //抽取标题索引
            $('h1,h2,h3,h4,h5,h6').each(function (i) {
                $(this).attr('id', 'anchor-' + i);
            })
        } else {
//            navHtml += '<header><h1>' + text + '</h1></header>';
        }
        if ($('.api-section').length > 0) {
            navHtml += '<div class="index-nav index-endpoints">';
            navHtml += '    <ul>';
            $('.api-section').each(function (item) {
                var id = $(this).attr('id');
                var method = $(this).find('.api-method').eq(0).text().toUpperCase();
                var api = $(this).find('.api-rule').eq(0)[0].innerHTML;
                var desc = $(this).find('.api-description').eq(0).find('p').eq(0).text();
                navHtml += '        <li>';
                navHtml += '            <a href="#' + id + '">';
                navHtml += '                <span class="type">' + method + '</span>';
                navHtml += '                <b>' + api + '</b>';
                navHtml += '                <span class="description">' + desc + '</span>';
                navHtml += '                <i></i>';
                navHtml += '            </a>';
                navHtml += '        </li>';
            });
            navHtml += '    </ul>';
            navHtml += '</div>';
        }
        $('.nav-page-content').prepend(navHtml);
        var sidebar = $('.sidebar');
        $(window).on('scroll', function () {
            var scrollTop = $(this).scrollTop();
//            console.log(scrollTop);
//            if (scrollTop > 62) {
//                sidebar.css({'position': 'fixed', 'top': '0'});
//            }else {
//                sidebar.css({'position': 'absolute', 'top': 62});
//            }
            if (scrollTop > $(this).height()) {
                $('#btn_top').show();
            } else {
                $('#btn_top').hide();
            }
        });
    });
</script>
</body>
</html>
