
<a href="../../static/download/sdk_server_demo_v1.0.zip" target="_blank" class="sdk-download">下载服务端SDK</a>

## 环境
- 测试环境：[ http://test.gameservice.com:15205 ](/ "测试环境")
- 仿真环境：[ http://test.api.gameservice.com ](/ "仿真环境")
- 正式环境：[ https://api.gameservice.com ](/ "正式环境")

### SDK测试:

- APP_ID = 8  # android
- APP_SECRET = 'sVDIlIiDUm7tWPYWhi6kfNbrqui3ez44'

- APP_ID = 9  # ios
- APP_SECRET = '0WiCxAU1jh76SbgaaFC7qIaBPm2zkyM1'

- CHANNEL_ID = 14

## 开发者服务器回调
- 请求地址：**POST {{生成订单传的notify_url}} **
- 请求内容：

    amount=1&app_id=1&app_order_id=123467983411&app_user_id=123&app_user_name=角色名&body=充值卡测试1&create_time=1403896654&notify_time=1403897051&order_id=20140627162026744468&payment_time=1403897051&status=STATUS_SUCCESS&subject=充值卡测试1

- 成功响应：
    根据status判断是否STATUS_SUCCESS，是处理相关业务后，直接输出 success，业务处理失败输出fail
- 失败响应:
    除了success以外，都认为是失败

## 签名机制
###  需要参与签名的参数
- 在请求参数列表中，除去sign、payment参数外，其他需要使用到的参数皆是要签名的参数。
- 在服务器异步通知参数列表中，除去sign参数外，凡是通知返回回来的参数皆是要验签的参数。
### 生成待签名字符串
生成订单待签名字符串生成

对于如下的参数数组：

        {
            "body": "新游测试商品2",
            "subject": "新游测试商品2",
            "amount": 2,
            "app_user_name": "新游角色名",
            "app_id": 8,
            "app_order_id": "201407071002",
            "imei": "447769804451095",
            "ext": "",
            "notify_url": "http://test.gameservice.com:15205/test_pay/test",
            "app_user_id": "123",
            "mac_address": "05-16-DC-59-C2-34",
            "channel_id": "14",
            "payment": {
                "payment_type": 5
            }
        }

去掉sign、payment参数，将其他参数按照字母顺序升序排列，再把所有数组值以“&”字符连接起来：
    
    amount=2&app_id=8&app_order_id=201407071002&app_user_id=123&app_user_name=新游角色名&body=新游测试商品2&channel_id=14&imei=447769804451095&mac_address=05-16-DC-59-C2-34&notify_url=http://test.gameservice.com:15205/test_pay/test&subject=新游测试商品2
    
即为待签名字符串。
注意：

* 没有值的参数无需传递，也无需包含到待签名数据中；

### RSA签名
在RSA的签名时，需要私钥和公钥一起参与签名。私钥与公钥皆是客户通过OPENSSL来生成得出的。客户把生成出的公钥与新游平台技术人员配置好的新游公钥做交换。因此，在签名时，客户要用到的是客户的私钥及新游的公钥。
公钥、私钥暂时用支付宝的测试。

*请求时签名
当拿到请求时的待签名字符串后，把待签名字符串与客户的私钥一同放入RSA的签名函数中进行签名运算，从而得到签名结果字符串。

*通知返回时验证签名
当获得到通知返回时的待签名字符串后，把待签名字符串、新游提供的公钥、新游通知返回参数中的参数sign的值三者一同放入RSA的签名函数中进行非对称的签名运算，来判断签名是否验证通过。

*签名函数
 RSA sign + base64 encode
 
 具体实现见范例代码。
 
上例中签名结果为

    GY5RuVWYjP4BiTLX67GeiTDwpi2+deuXO/pkVvoxiiOCtcKsNnSE4niFQIa2F2tz/VpVXfyEoKFxjXJ3e8J+r76ERtd2MlpIJ0bEWb5/J9OFDcZjEUXAJ0+h1xeoVtid6FHsC3ERN2iOFD8UUvk6HnUyo5ZmIrILVgOUglQBvk8=